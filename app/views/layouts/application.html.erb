<!DOCTYPE html>
<html>
  <head>
    <title>SpreeStarter</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body>
    <%= yield %>
      <script>
        // Header customization - removes search, repositions account to left of logo
        (function() {
          function customizeHeader() {
            console.log('Running header customization...');
            
            // Hide wishlist form
            const wishlistForm = document.querySelector('header form[action="/account/wishlist"], header form[action*="/wishlist"]');
            if (wishlistForm) {
              wishlistForm.style.cssText = 'display: none !important; visibility: hidden !important;';
            }
            
            // Hide wishlist button by ID
            const wishlistButton = document.querySelector('header #wishlist-icon');
            if (wishlistButton) {
              wishlistButton.style.cssText = 'display: none !important; visibility: hidden !important;';
            }

            // Find the main header container
            const mainContainer = document.querySelector('header nav .page-container > .flex.items-center, header nav .page-container > .flex');
            if (!mainContainer) {
              console.log('Main container not found');
              return;
            }

            // Hide search - find first child that contains SEARCH text but not account button
            const firstChild = mainContainer.children[0];
            if (firstChild) {
              const firstChildText = firstChild.textContent.trim().toUpperCase();
              const hasSearch = firstChildText.includes('SEARCH');
              const hasAccount = firstChild.querySelector('button[data-action*="slideover-account"]') !== null;
              
              console.log('First child:', { text: firstChildText, hasSearch, hasAccount });
              
              if (hasSearch && !hasAccount) {
                firstChild.style.cssText = 'display: none !important; visibility: hidden !important;';
                console.log('Hiding search container');
              }
            }
            
            // Hide any search buttons/links
            const allElements = mainContainer.querySelectorAll('a, button');
            allElements.forEach(el => {
              const text = el.textContent.trim().toUpperCase();
              const dataAction = el.getAttribute('data-action') || '';
              
              if (text.includes('SEARCH') || dataAction.includes('search')) {
                if (!dataAction.includes('account')) {
                  el.style.cssText = 'display: none !important; visibility: hidden !important;';
                }
              }
            });

            // Setup flexbox layout
            mainContainer.style.cssText = 'display: flex !important; justify-content: space-between !important; width: 100% !important; align-items: center !important;';
            
            // Find and position account button on the LEFT
            const accountButton = document.querySelector('header button[data-action*="slideover-account"]');
            if (accountButton) {
              console.log('Found account button');
              accountButton.style.cssText = 'display: flex !important; visibility: visible !important; order: -1 !important; margin-right: auto !important;';
              
              // Find account button's parent container and move it to the left
              let accountContainer = accountButton.parentElement;
              while (accountContainer && accountContainer !== mainContainer) {
                if (accountContainer.classList.contains('flex') && accountContainer !== mainContainer) {
                  accountContainer.style.cssText = 'display: flex !important; visibility: visible !important; order: -1 !important; margin-right: auto !important;';
                  console.log('Moved account container to left');
                  break;
                }
                accountContainer = accountContainer.parentElement;
              }
            } else {
              console.log('Account button not found');
            }
            
            // Find and position cart button on the RIGHT
            const cartButton = document.querySelector('header button[data-action*="cart"], header button[data-action*="slideover-cart"]');
            if (cartButton) {
              console.log('Found cart button');
              cartButton.style.cssText = 'order: 999 !important; margin-left: auto !important;';
              
              let cartContainer = cartButton.parentElement;
              while (cartContainer && cartContainer !== mainContainer) {
                if (cartContainer.classList.contains('flex') && cartContainer !== mainContainer) {
                  cartContainer.style.cssText = 'order: 999 !important; margin-left: auto !important;';
                  break;
                }
                cartContainer = cartContainer.parentElement;
              }
            }
            
            // Ensure logo stays centered (middle order)
            const logoContainer = mainContainer.querySelector('.flex.items-center.flex-col.header-nav-container');
            if (logoContainer) {
              logoContainer.style.cssText = 'order: 0 !important; flex: 0 1 auto !important;';
            }
          }

          // Run immediately
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', customizeHeader);
          } else {
            customizeHeader();
          }

          // Run multiple times to catch late-loading elements
          setTimeout(customizeHeader, 100);
          setTimeout(customizeHeader, 300);
          setTimeout(customizeHeader, 500);
          setTimeout(customizeHeader, 1000);
          setTimeout(customizeHeader, 2000);

          // Turbo events
          if (typeof Turbo !== 'undefined') {
            document.addEventListener('turbo:load', customizeHeader);
            document.addEventListener('turbo:frame-load', customizeHeader);
          }
        })();
      </script>
  </body>
</html>
