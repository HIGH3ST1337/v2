<!DOCTYPE html>
<html>
  <head>
    <title>SpreeStarter</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body>
    <%= yield %>
      <script>
        // Header customization - removes search, repositions account to left of logo
        (function() {
          function customizeHeader() {
            // Hide wishlist form
            const wishlistForm = document.querySelector('header form[action="/account/wishlist"], header form[action*="/wishlist"]');
            if (wishlistForm) {
              wishlistForm.style.cssText = 'display: none !important; visibility: hidden !important;';
            }
            
            // Hide wishlist button by ID
            const wishlistButton = document.querySelector('header #wishlist-icon');
            if (wishlistButton) {
              wishlistButton.style.cssText = 'display: none !important; visibility: hidden !important;';
            }

            // Hide search button - find the first div in the flex container that contains search
            const mainContainer = document.querySelector('header nav .page-container > .flex.items-center, header nav .page-container > .flex');
            if (mainContainer) {
              const firstChild = mainContainer.children[0];
              if (firstChild) {
                const hasSearch = firstChild.textContent.trim().toUpperCase().includes('SEARCH') || 
                                 firstChild.querySelector('button[data-action*="search"]') ||
                                 firstChild.querySelector('[data-controller*="search"]');
                const hasAccount = firstChild.querySelector('button[data-action*="slideover-account"]') ||
                                  firstChild.querySelector('button[data-action*="account"]');
                
                // Hide first child only if it has search but NOT account
                if (hasSearch && !hasAccount) {
                  firstChild.style.cssText = 'display: none !important; visibility: hidden !important;';
                }
              }
              
              // Also hide any buttons with search in data-action
              const searchButtons = mainContainer.querySelectorAll('button[data-action*="search"], [data-controller*="search"]');
              searchButtons.forEach(btn => {
                const isAccount = btn.getAttribute('data-action') && btn.getAttribute('data-action').includes('account');
                if (!isAccount) {
                  btn.style.cssText = 'display: none !important; visibility: hidden !important;';
                }
              });
            }

            // Find the main header container
            if (mainContainer) {
              mainContainer.style.cssText = 'display: flex !important; justify-content: space-between !important; width: 100% !important; align-items: center !important;';
              
              // Find account button - make sure it's visible and positioned on the left
              const accountButton = document.querySelector('header button[data-action*="slideover-account"]');
              if (accountButton) {
                // Ensure account button is visible
                accountButton.style.cssText = 'display: flex !important; visibility: visible !important; order: -1 !important; margin-right: auto !important;';
                
                // Move account button's container to the left
                const accountContainer = accountButton.closest('.flex.items-center.gap-4, .flex.items-center');
                if (accountContainer && accountContainer !== mainContainer) {
                  accountContainer.style.cssText = 'display: flex !important; visibility: visible !important; order: -1 !important; margin-right: auto !important;';
                }
              }
              
              // Find cart button and keep it on the right
              const cartButton = document.querySelector('header button[data-action*="cart"], header button[data-action*="slideover-cart"]');
              if (cartButton) {
                cartButton.style.cssText = 'order: 999 !important; margin-left: auto !important;';
                const cartContainer = cartButton.closest('.flex.items-center.gap-4, .flex.items-center');
                if (cartContainer && cartContainer !== mainContainer) {
                  cartContainer.style.cssText = 'order: 999 !important; margin-left: auto !important;';
                }
              }
              
              // Ensure logo/nav stays centered
              const logoContainer = mainContainer.querySelector('.flex.items-center.flex-col.header-nav-container, .flex-centered');
              if (logoContainer) {
                logoContainer.style.cssText = 'order: 0 !important; flex: 0 1 auto !important; margin: 0 auto !important;';
              }
            }
          }

          // Run immediately and on various events
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', customizeHeader);
          } else {
            customizeHeader();
          }

          // Also run after delays to catch late-loading elements
          setTimeout(customizeHeader, 100);
          setTimeout(customizeHeader, 500);
          setTimeout(customizeHeader, 1000);
          setTimeout(customizeHeader, 2000);

          // Turbo events
          if (typeof Turbo !== 'undefined') {
            document.addEventListener('turbo:load', customizeHeader);
            document.addEventListener('turbo:frame-load', customizeHeader);
          }
        })();
      </script>
  </body>
</html>
