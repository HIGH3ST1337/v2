<!DOCTYPE html>
<html>
  <head>
    <title>SpreeStarter</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body>
    <%= yield %>
      <script>
        // Header customization - removes search and favorites, repositions account and cart
        (function() {
          function customizeHeader() {
            // Hide wishlist form
            const wishlistForm = document.querySelector('header form[action="/account/wishlist"], header form[action*="/wishlist"]');
            if (wishlistForm) {
              wishlistForm.style.display = 'none';
              wishlistForm.style.visibility = 'hidden';
            }
            
            // Hide wishlist button by ID
            const wishlistButton = document.querySelector('header #wishlist-icon');
            if (wishlistButton) {
              wishlistButton.style.display = 'none';
              wishlistButton.style.visibility = 'hidden';
            }

            // Hide search button - look for button with search in data-action
            const searchButtons = document.querySelectorAll('header button[data-action*="search"], header [data-controller*="search"]');
            searchButtons.forEach(btn => {
              btn.style.display = 'none';
              btn.style.visibility = 'hidden';
            });

            // Find the container that holds account and cart
            const container = document.querySelector('header .flex.items-center.gap-4.flex-1.justify-end');
            if (container) {
              container.style.display = 'flex';
              container.style.justifyContent = 'space-between';
              container.style.width = '100%';
              
              // Find account button
              const accountButton = container.querySelector('button[data-action*="slideover-account"]');
              if (accountButton) {
                accountButton.style.order = '-1';
                accountButton.style.marginRight = 'auto';
              }
              
              // Find cart button
              const cartButton = container.querySelector('button[data-action*="cart"]');
              if (cartButton) {
                cartButton.style.order = '999';
                cartButton.style.marginLeft = 'auto';
              }
            }
          }

          // Run immediately and on various events
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', customizeHeader);
          } else {
            customizeHeader();
          }

          // Also run after delays to catch late-loading elements
          setTimeout(customizeHeader, 100);
          setTimeout(customizeHeader, 500);
          setTimeout(customizeHeader, 1000);

          // Turbo events
          if (typeof Turbo !== 'undefined') {
            document.addEventListener('turbo:load', customizeHeader);
            document.addEventListener('turbo:frame-load', customizeHeader);
          }
        })();
      </script>
  </body>
</html>
