<!DOCTYPE html>
<html>
  <head>
    <title>SpreeStarter</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body>
    <%= yield %>
      <script>
        // Header customization - removes search, repositions account to left of logo
        (function() {
          function customizeHeader() {
            // Hide wishlist form
            const wishlistForm = document.querySelector('header form[action="/account/wishlist"], header form[action*="/wishlist"]');
            if (wishlistForm) {
              wishlistForm.style.cssText = 'display: none !important; visibility: hidden !important;';
            }
            
            // Hide wishlist button by ID
            const wishlistButton = document.querySelector('header #wishlist-icon');
            if (wishlistButton) {
              wishlistButton.style.cssText = 'display: none !important; visibility: hidden !important;';
            }

            // Hide search button - multiple strategies
            const searchButtons = document.querySelectorAll('header button[data-action*="search"], header [data-controller*="search"], header button[data-toggle*="search"]');
            searchButtons.forEach(btn => {
              btn.style.cssText = 'display: none !important; visibility: hidden !important;';
            });

            // Hide search link/text - find elements containing "SEARCH" text
            const allElements = document.querySelectorAll('header nav *');
            allElements.forEach(el => {
              const text = el.textContent.trim().toUpperCase();
              if (text === 'SEARCH' || (text.includes('SEARCH') && el.tagName === 'A')) {
                el.style.cssText = 'display: none !important; visibility: hidden !important;';
                // Also hide parent if it only contains search
                if (el.parentElement) {
                  const siblings = Array.from(el.parentElement.children).filter(child => 
                    child.style.display !== 'none' && !child.hasAttribute('hidden')
                  );
                  if (siblings.length <= 1) {
                    el.parentElement.style.cssText = 'display: none !important; visibility: hidden !important;';
                  }
                }
              }
            });

            // Find the main header container
            const mainContainer = document.querySelector('header nav .page-container > .flex.items-center, header nav .page-container > .flex');
            if (mainContainer) {
              mainContainer.style.cssText = 'display: flex !important; justify-content: space-between !important; width: 100% !important; align-items: center !important;';
              
              // Find account button anywhere in header
              const accountButton = document.querySelector('header button[data-action*="slideover-account"], header button[data-action*="account"]');
              if (accountButton) {
                // Move account button to the left (before logo)
                accountButton.style.cssText = 'order: -1 !important; margin-right: auto !important;';
                // If it's in a container, move the container
                const accountContainer = accountButton.closest('.flex.items-center.gap-4');
                if (accountContainer && accountContainer !== mainContainer) {
                  accountContainer.style.cssText = 'order: -1 !important; margin-right: auto !important;';
                }
              }
              
              // Find cart button and keep it on the right
              const cartButton = document.querySelector('header button[data-action*="cart"], header button[data-action*="slideover-cart"]');
              if (cartButton) {
                cartButton.style.cssText = 'order: 999 !important; margin-left: auto !important;';
                const cartContainer = cartButton.closest('.flex.items-center.gap-4');
                if (cartContainer && cartContainer !== mainContainer) {
                  cartContainer.style.cssText = 'order: 999 !important; margin-left: auto !important;';
                }
              }
              
              // Ensure logo/nav stays centered
              const logoContainer = mainContainer.querySelector('.flex.items-center.flex-col.header-nav-container, .flex-centered');
              if (logoContainer) {
                logoContainer.style.cssText = 'order: 0 !important; flex: 0 1 auto !important;';
              }
            }
          }

          // Run immediately and on various events
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', customizeHeader);
          } else {
            customizeHeader();
          }

          // Also run after delays to catch late-loading elements
          setTimeout(customizeHeader, 100);
          setTimeout(customizeHeader, 500);
          setTimeout(customizeHeader, 1000);
          setTimeout(customizeHeader, 2000);

          // Turbo events
          if (typeof Turbo !== 'undefined') {
            document.addEventListener('turbo:load', customizeHeader);
            document.addEventListener('turbo:frame-load', customizeHeader);
          }
        })();
      </script>
  </body>
</html>
